{% extends 'base.html' %}
{% load static %}
{% load hitcount_tags %}

{% block title %}
    <title>Plumar | Start-up</title>
{% endblock title %}

{% block header %}
{% endblock header %}


{% block contents %}
{% include 'includes/nav.html' %}
<style>
    #follow, .follow{
        height: 46px;
    }
    
</style>

        <!-- Breadcrumb Section Start -->
        <div class="breadcrumb-section section pt-60 pt-sm-50 pt-xs-40">
            <div class="container sb-border-two pb-60 pb-sm-50 pb-xs-40">
                <div class="row">
                    <div class="col-12">
                        <div class="page-breadcrumb-content mb-40">
                            <ul class="page-breadcrumb">
                                <li><a href="{% url 'home' %}">Home</a></li>
                                <li><a href="{% url 'startups' %}">startups</a></li>
                                <li>{{ data.name }} </li>
                            </ul>
                        </div>
                    </div>
                </div>
                <div class="row align-items-center">
                    <div class="col-lg-7">
                        <div class="employer-head-info">
                            <div class="employer-logo">
                                <a href="#">
                                    {% if data.logo %}
                                    <img src="{{data.logo.url}}" alt="">
                                    {% endif %}
                                </a>
                            </div>
                            <div class="employer-content">
                                <h1 class="employer-name">{{ data.name }} <i class="fas fa-check-circle"></i></h1>
                                <div class="employer-rate">
                                    <div class="star">
                                       {% include 'includes/rating.html' %}
                                    </div> 
                                </div>
                                <ul class="employer-meta">
                                    <li class="view-employer"><i class="lnr lnr-eye"></i> {% get_hit_count for data %} Views</li>
                                    <li class="followers">
                                        <i class="lnr lnr-location"></i> 
                                        <span id="count2" ></span>
                                       <span  id="count" > {{data.followers.all.count}} follower{{data.followers.all.count|pluralize}}</span>
                                      
                                    </li>
                                    <li class="date-publish">
                                        <i class="lnr lnr-clock"></i>
                                        Registered on: <label class="theme-color">{{ data.registered_on|date:"m d, Y" }}</label>
                                    </li>
                                </ul>
                            </div>
                        </div>
                    </div>
                    <div class="col-lg-5">
                        <div class="sidebar-wrapper-three">
                            <div class="common-sidebar-widget sidebar-three mb-0 pb-0">
                                <div class="sidebar-job-share">
                                    <div class="job-share candidate-action">
                                        <ul>
                                            {% if user.is_authenticated %}
                                            <li class="bg-warning" >
                                                {% if request.user in data.followers.all %}
                                                    <button value="{{data.id}}" id="follow" class="btn btn-warning   text-white font-weight-bold">
                                                        <span id="follow{{data.id}}" class="text-white" >Following</span>
                                                    </button>
                                                {% else %}
                                                    <button value="{{data.id}}" id="follow" class=" btn btn-warning   text-white font-weight-bold">
                                                        <span id="follow{{data.id}}" class="text-dark" >Follow</span>
                                                    </button>
                                                {% endif %}  
                                            </li>
                                            {% else %}
                                            <li class="warning" >
                                                <button class=" follow btn btn-warning bnn-sm text-white font-weight-bold" >Follow</button>
                                            </li>
                                            {% endif %}
                                            {% include 'includes/social_share.html' %}
                                            <li class="bg-warning" ><a onMouseOver="this.style.background='#fcc102'" style="border-color: #fcc102;" href="#"><i class="lnr lnr-warning text-dark"></i> <span class="text text-dark">Report </span></a></li>
                                        </ul>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <!-- Breadcrumb Section Start -->

        <!-- Employer Details Section Start -->
        <div class="employer-details-section section pt-120 pt-lg-100 pt-md-80 pt-sm-50 pt-xs-40 pb-120 pb-lg-100 pb-md-80 pb-sm-60 pb-xs-50">
            <div class="container">
                <div class="row">

                    <div class="col-lg-4 order-lg-2 order-2 mt-sm-60 mt-xs-50">
                        <div class="sidebar-wrapper-three">
                            <div class="common-sidebar-widget sidebar-three">
                                <div class="sidebar-meta sidebar-meta-two">

                                    <!-- Single Meta Field Start -->
                                    <div class="single-meta-field meta-field-two">
                                        <div class="field-label">
                                            <i class="lnr lnr-tag text-warning"></i>
                                            <span>Categories </span>
                                        </div>
                                        <div class="field-value text-warning">{{ data.category }}</div>
                                    </div>
                                    <!-- Single Meta Field Start -->

                                    <!-- Single Meta Field Start -->
                                    <div class="single-meta-field meta-field-two">
                                        <div class="field-label">
                                            <i class="lnr lnr-users text-warning"></i>
                                            <span>Size </span>
                                        </div>
                                        <div class="field-value text-warning "><a class="text-warning" href="#">{{ data.size }}</a></div>
                                    </div>
                                    <!-- Single Meta Field Start -->

                                    <!-- Single Meta Field Start -->
                                    <div class="single-meta-field meta-field-two">
                                        <div class="field-label">
                                            <i class="lnr lnr-earth text-warning"></i>
                                            <span>Website </span>
                                        </div>
                                        <div class="field-value"><a class="text-warning" href="{{ data.website }}">{{ data.website }}</a></div>
                                    </div>
                                    <!-- Single Meta Field Start -->

                                    <!-- Single Meta Field Start -->
                                    <div class="single-meta-field meta-field-two">
                                        <div class="field-label">
                                            <i class="lnr lnr-map-marker text-warning"></i>
                                            <span>Location </span>
                                        </div>
                                        <div class="field-value"><a class="text-warning" href="#">{{data.location}}</a></div>
                                    </div>
                                    <!-- Single Meta Field Start -->

                                    <div class="sidebar-social mt-20">
                                        <div class="social-all">
                                            <a class="facebook" href="#"><i class="fab fa-facebook"></i></a>
                                            <a class="twitter" href="#"><i class="fab fa-twitter"></i></a>
                                            <a class="linkedin" href="#"><i class="fab fa-linkedin"></i></a>
                                        </div>
                                    </div>

                                </div>
                            </div>
                            <!-- <div class="common-sidebar-widget sidebar-three">
                                <h2 class="sidebar-title">Location</h2>
                                <div class="sidebar-map">
                                    <iframe class="contact-map" src="https://www.google.com/maps/embed?pb=!1m18!1m12!1m3!1d2136.986005919501!2d-73.9685579655238!3d40.75862446708152!2m3!1f0!2f0!3f0!3m2!1i1024!2i768!4f13.1!3m3!1m2!1s0x89c258e4a1c884e5%3A0x24fe1071086b36d5!2sThe%20Atrium!5e0!3m2!1sen!2sbd!4v1585132512970!5m2!1sen!2sbd" allowfullscreen="" aria-hidden="false" tabindex="0"></iframe>
                                </div>
                            </div> -->
                        </div>
                    </div>

                    <div class="col-lg-8 order-lg-1 order-1 pr-55 pr-md-15 pr-sm-15 pr-xs-15">

                        <div class="employer-main-content">
                            <div class="field-description">
                                <h6>{{ data.description }}</h6>

                                <h3>What You Will Get</h3>
                                <p>{{ data.what_we_offer }}</p>
                            </div>
                            <div class="field-skills">
                                <h3>Skills Required</h3>
                                <ul class="skill-tag">
                                    {% for data in data.get_required_skills %}
                                    <li><a href="#">{{ data.skill }}</a></li>
                                    {% endfor %}
                                </ul>
                            </div>

                            {% if request.user.profile.user_type == 'talent' %}
                            <div class="mb-3">
                                <button class="btn btn-warning font-weight-bold " data-bs-target="#rate" data-bs-toggle="modal" >
                                    Rate This Start-up
                                </button>
                            </div>
                            {% endif %}
                   
                            <div class="job-area mt-60">
                                <div class="job-container">
                                    <h3 class="title">Latest Open Opportunities</h3>
                                    <div class="row">
                                        {% for data in data.get_opportunities|slice:"2" %}
                                        <div class="col-lg-12">
                                            <!-- Single Job Start  -->
                                            <div class="single-job style-two">
                                                <div class="info-top">
                                                    <div class="job-info">
                                                        <div class="job-info-inner">
                                                            <div class="job-info-top">
                                                                <div class="saveJob for-listing">
                                                                    <!-- <span class="featured-label">featured</span> -->
                                                                    <a class="job-type-label ml-20 mr-20">{{ data.category }}</a>
                                                                    <!-- <a class="save-job" href="#quick-view-modal-container" data-toggle="modal">
                                                                        <i class="far fa-heart"></i>
                                                                    </a> -->
                                                                </div>
                                                                <div class="title-name">
                                                                    <h5 class="job-title">
                                                                        <a href="#">{{ data.title }}</a>
                                                                    </h5>
                                                                </div>
                                                            </div>
                                                            <div class="job-meta-two">
                                                                <div class="field-salary_from">
                                                                    <i class="gj-icon gj-icon-money"></i>
                                                                   {{data.salary_range}} / month
                                                                </div>
                                                                <div class="field-datetime"><i class="lnr lnr-clock"></i>{{ data.published }}</div>
                                                                <div class="field-map"><i class="lnr lnr-map-marker"></i>{{ data.location }}</div>
                                                            </div>
                                                            <div class="job-skill-tag">
                                                                {% for data in data.get_skills %}
                                                                    <a href="#">{{ data.skill }}</a>
                                                                {% endfor%}
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                            <!-- Single Job End -->
                                        </div>
                                        {% endfor %}

                        
                                    </div>
                                </div>
                            </div>
                        </div>

                    </div>

                </div>
            </div>
        </div>
        <!-- Employer Details Section End -->


        <div class="modal fade" id="rate" data-bs-backdrop="static" data-bs-keyboard="false" tabindex="-1" aria-labelledby="staticBackdropLabel" aria-hidden="true">
            <div class="modal-dialog">
              <div class="modal-content">
                <div class="modal-header">
                  <h5 class="modal-title" id="staticBackdropLabel">Review A Talent</h5>
                  <a type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close">&#10006;</a>
                </div>
                <div class="modal-body">
                    <form action="{% url 'rate_startup' data.id %}" method="POST" class="form-group" >
                        {% csrf_token %}
                          <div class="form-group">
                            <fieldset class="rating">
                                <legend>Select Stars</legend>
                              
                                <input id="demo-1" type="radio" name="ratings" value="1"> 
                                <label for="demo-1">1 star</label>
                                <input id="demo-2" type="radio" name="ratings" value="2">
                                <label for="demo-2">2 stars</label>
                                <input id="demo-3" type="radio" name="ratings" value="3">
                                <label for="demo-3">3 stars</label>
                                <input id="demo-4" type="radio" name="ratings" value="4">
                                <label for="demo-4">4 stars</label>
                                <input id="demo-5" type="radio" name="ratings" value="5">
                                <label for="demo-5">5 stars</label>
                                
                                <div class="stars">
                                    <label for="demo-1" aria-label="1 star" title="1 star"></label>
                                    <label for="demo-2" aria-label="2 stars" title="2 stars"></label>
                                    <label for="demo-3" aria-label="3 stars" title="3 stars"></label>
                                    <label for="demo-4" aria-label="4 stars" title="4 stars"></label>
                                    <label for="demo-5" aria-label="5 stars" title="5 stars"></label>   
                                </div>
                                
                            </fieldset>
                          </div>
                          
                          <input type="hidden" value="{{data.id}}" name="rating_for">
                      
                          <div class="form-group">
                            <label for="">Comments</label>
                            <textarea class="form-control" name="comments" id="" cols="20" rows="5"></textarea>
                          </div>
                          <div class="modal-footer justify-content-center">
                            <button  style="width: 100%;" type="submit" class="btn btn-warning">Submit You Review</button>
                          </div>
                      </form>
                </div>
                
              </div>
            </div>
        </div>







        <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.1/jquery.min.js"></script>
        <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.10.2/dist/umd/popper.min.js" ></script>
        <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.min.js" ></script>        
        <script>
          
            $(document).on('click', '#follow', function(e){
                e.preventDefault();

                var pk = $(this).attr('value');
                
                $.ajax({
                    type:'POST',
                    url:'{% url "follow" %}',
                    data:{
                        'id':pk,
                        'csrfmiddlewaretoken':'{{csrf_token}}'
                    },
                    success:function(response){
                        console.log(response)

                        // for toggling/changing color class on click
                        $('#follow'+pk).toggleClass('text-white text-dark')
                        
                       
                        // for changing text when follow button is klicked
                        if($('#follow'+pk).text() == 'Follow'){
                            $('#follow'+pk).text('Following')
                        }
                        else {
                            $('#follow'+pk).text('Follow')
                        }

                        // for changing followers count when button is clicked 
                        if( response.is_followed == true){
                            $('#count').hide()
                            $('#count2 :nth-child(1)').remove()
                            if(response.count == 1 ){
                                $('#count2').append('<span>'+response.count+' follower</span>')
                            }else{
                                $('#count2').append('<span>'+response.count+' followers</span>')
                            }
                            

                        }else if( response.is_followed == false){
                            $('#count').hide()
                            $('#count2 :nth-child(1)').remove()
                            if(response.count == 1 ){
                                $('#count2').append('<span>'+response.count+' follower</span>')
                            }else{
                                $('#count2').append('<span>'+response.count+' followers</span>')
                            }
 
                        }
    
                
                    },
                    errror: function(rs,e){
                        console.log(rs.responseText);
                    }
                })
            })

            $('.follow').on('click', function(){
                swal({
                    title: 'Your have to be a registered user to follow a startup',
                    text: 'if you have an account login to follow this startup, else register first',
                    icon: "info",
                    buttons: false,
                    timer: 5000,
                    
                })
            })
        </script>

        {% endblock contents %}

  